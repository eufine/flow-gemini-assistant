name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt -t lib
        pip install polib
    
    - name: Compile translations
      run: |
        python compile_translations.py
    
    - name: Create plugin package
      run: |
        # Remove unnecessary files
        rm -rf lib/__pycache__
        rm -rf plugin/__pycache__
        rm -f settings.json
        rm -f .env
        rm -f plugin/ui.py.backup
        
        # Create zip
        zip -r plugin.zip . \
          -x "*.git*" \
          -x "*.github*" \
          -x "*__pycache__*" \
          -x "*.pyc" \
          -x ".env" \
          -x "settings.json" \
          -x "*.backup"
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: plugin.zip
        body: |
          ## AI Assistant for Gemini ${{ github.ref_name }}
          
          Quick AI queries using Google's Gemini API directly from Flow Launcher.
          
          ### Features
          - üåç Multilingual support (English & Spanish)
          - üöÄ Multiple Gemini models
          - ‚ö° Fast responses
          
          ### Installation
          Install from Flow Launcher Plugin Store or download the zip file below.
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
